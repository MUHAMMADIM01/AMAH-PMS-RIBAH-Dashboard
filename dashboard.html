<!DOCTYPE html>
<html lang="ha">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Amah Medicine Store — Dashboard</title>

  <style>
    body {
      font-family: Arial;
      padding: 20px;
      background: #f2f7f7;
    }

    .card {
      background: white;
      padding: 20px;
      margin-top: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 8px #aaa;
    }

    input, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      margin-bottom: 10px;
      border-radius: 5px;
      border: 1px solid #777;
    }

    button {
      padding: 10px 18px;
      background: teal;
      border: none;
      border-radius: 5px;
      color: white;
      cursor: pointer;
    }

    .deleteBtn {
      background: red;
      margin-left: 5px;
    }

    .editBtn {
      background: orange;
      margin-left: 5px;
    }
  </style>
</head>

<body>

<h2>Amah Medicine Store — Dashboard</h2>
<button id="logoutBtn" style="float:right; background:red;">Logout</button>
<br><br>

<!-- ADD MEDICINE -->
<div class="card">
  <h3>Add Medicine</h3>
  <input id="mName" placeholder="Medicine Name">
  <input id="mPrice" placeholder="Price">
  <textarea id="mDesc" placeholder="Description"></textarea>
  <input id="mImg" type="file">
  <button onclick="addMedicine()">Add Medicine</button>
</div>

<!-- SHOW MEDICINES -->
<div class="card">
  <h3>All Medicines</h3>
  <div id="medicineList"></div>
</div>

<!-- ADD TIPS -->
<div class="card">
  <h3>Add Health Tip</h3>
  <input id="tTitle" placeholder="Title">
  <textarea id="tDesc" placeholder="Description"></textarea>
  <button onclick="addTip()">Add Tip</button>
</div>

<!-- SHOW TIPS -->
<div class="card">
  <h3>All Tips</h3>
  <div id="tipsList"></div>
</div>

<script type="module">
  
  /* 1. IMPORT FIREBASE FILES */
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut }
    from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
  import { getDatabase, ref, push, set, onValue, remove, update }
    from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
  import { getStorage, ref as sRef, uploadBytes, getDownloadURL }
    from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";


  /* 2. FIREBASE CONFIG (DAKAI NAWA KUKA BA NI) */
  const firebaseConfig = {
    apiKey: "AIzaSyBqXjy7ogO8qMCsfuYB61yBpZJpKKKGhqk",
    authDomain: "amahmedicinestore-be61b.firebaseapp.com",
    databaseURL: "https://amahmedicinestore-be61b-default-rtdb.firebaseio.com",
    projectId: "amahmedicinestore-be61b",
    storageBucket: "amahmedicinestore-be61b.appspot.com",
    messagingSenderId: "740301709370",
    appId: "1:740301709370:web:9fd66894daa25bd85b1503",
    measurementId: "G-NV6KNSM3CV"
  };


  /* 3. INITIALIZE FIREBASE */
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);
  const storage = getStorage(app);


  /* 4. PROTECT PAGE — SAI AN YI LOGIN */
  onAuthStateChanged(auth, (user) => {
    if (!user) {
      window.location.href = "login.html";
    }
  });


  /* 5. LOGOUT */
  logoutBtn.onclick = () => {
    signOut(auth);
  };


  /* 6. ADD MEDICINE */
  window.addMedicine = async function () {

    let name = mName.value.trim();
    let price = mPrice.value.trim();
    let desc = mDesc.value.trim();
    let file = mImg.files[0];

    if (!name || !price || !desc || !file) {
      alert("Please fill all fields");
      return;
    }

    // Upload Image
    const imgRef = sRef(storage, "medicines/" + file.name);
    await uploadBytes(imgRef, file);
    let imgURL = await getDownloadURL(imgRef);

    // Save to DB
    let newRef = push(ref(db, "medicines"));
    await set(newRef, {
      name, price, desc, img: imgURL
    });

    alert("Medicine Added Successfully!");
  };


  /* 7. LOAD MEDICINES */
  function loadMedicines() {
    onValue(ref(db, "medicines"), snapshot => {
      let data = snapshot.val();
      let html = "";

      for (let id in data) {
        html += `
          <div style="margin-bottom:10px; border-bottom:1px solid #ccc;">
            <b>${data[id].name}</b> — ₦${data[id].price} <br>
            <img src="${data[id].img}" width="100"><br>
            ${data[id].desc}<br>

            <button class="editBtn" onclick="editMedicine('${id}')">Edit</button>
            <button class="deleteBtn" onclick="deleteMedicine('${id}')">Delete</button>
          </div>
        `;
      }

      medicineList.innerHTML = html;
    });
  }
  loadMedicines();


  /* 8. DELETE MEDICINE */
  window.deleteMedicine = function (id) {
    if (confirm("Delete this medicine?")) {
      remove(ref(db, "medicines/" + id));
      alert("Deleted!");
    }
  };


  /* 9. EDIT MEDICINE */
  window.editMedicine = function (id) {

    let newName = prompt("New name:");
    let newPrice = prompt("New price:");
    let newDesc = prompt("New description:");

    update(ref(db, "medicines/" + id), {
      name: newName,
      price: newPrice,
      desc: newDesc
    });

    alert("Updated!");
  };


  /* 10. ADD TIP */
  window.addTip = function () {

    let title = tTitle.value.trim();
    let desc  = tDesc.value.trim();

    if (!title || !desc) {
      alert("Complete all fields");
      return;
    }

    let newRef = push(ref(db, "tips"));
    set(newRef, { title, desc });

    alert("Tip Added!");
  };


  /* 11. LOAD TIPS */
  function loadTips() {
    onValue(ref(db, "tips"), snapshot => {

      let data = snapshot.val();
      let html = "";

      for (let id in data) {
        html += `
          <div style="margin-bottom:10px; border-bottom:1px solid #ccc;">
            <b>${data[id].title}</b><br>
            ${data[id].desc}<br>

            <button class="editBtn" onclick="editTip('${id}')">Edit</button>
            <button class="deleteBtn" onclick="deleteTip('${id}')">Delete</button>
          </div>
        `;
      }

      tipsList.innerHTML = html;
    });
  }
  loadTips();


  /* 12. DELETE TIP */
  window.deleteTip = function (id) {
    if (confirm("Delete this tip?")) {
      remove(ref(db, "tips/" + id));
      alert("Deleted!");
    }
  };


  /* 13. EDIT TIP */
  window.editTip = function (id) {

    let newTitle = prompt("New title:");
    let newDesc = prompt("New description:");

    update(ref(db, "tips/" + id), {
      title: newTitle,
      desc: newDesc
    });

    alert("Updated!");
  };

</script>

</body>
</html>
