<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Amah Dashboard</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f0f8ff;
  margin: 0;
  padding: 0;
}
header {
  background: #004a7c;
  color: white;
  padding: 15px;
  text-align: center;
  font-size: 22px;
  font-weight: bold;
}
.container {
  width: 90%;
  margin: auto;
  padding: 20px;
}
.card {
  background: white;
  padding: 15px;
  margin-bottom: 20px;
  border-radius: 8px;
  box-shadow: 0 0 10px #ccc;
}
input, textarea, select {
  width: 100%;
  padding: 10px;
  margin-top: 8px;
  border-radius: 6px;
  border: 1px solid #aaa;
}
button {
  padding: 10px;
  margin-top: 10px;
  width: 100%;
  border: none;
  color: white;
  background: #007bff;
  border-radius: 6px;
  cursor: pointer;
}
.delete-btn {
  background: #d9534f !important;
}
.edit-btn {
  background: #5bc0de !important;
}
.logout-btn {
  background: #ff4444 !important;
}
img {
  max-width: 100px;
  margin-top: 10px;
  border-radius: 5px;
}
</style>
</head>

<body>

<header>üîê Amah Medicine Store - Admin Dashboard</header>

<div class="container">

<!-- LOGOUT -->
<button class="logout-btn" onclick="logout()">Logout</button>

<!-- CHANGE PASSWORD -->
<div class="card">
<h3>Change Admin Password</h3>
<input type="password" id="oldPass" placeholder="Old Password">
<input type="password" id="newPass" placeholder="New Password">
<button onclick="changePassword()">Change Password</button>

<button onclick="resetDefaultPass()" style="background:#b30000">
Reset Password to Default (Amah123)
</button>
</div>

<!-- ADD MEDICINE -->
<div class="card">
<h3>Add Medicine</h3>
<input type="text" id="medName" placeholder="Medicine Name">
<input type="number" id="medPrice" placeholder="Price (‚Ç¶)">
<textarea id="medDesc" placeholder="Description"></textarea>
<input type="file" id="medImg" accept="image/*">
<button onclick="addMedicine()">Add Medicine</button>
</div>

<!-- MEDICINE LIST -->
<div class="card">
<h3>Medicine List</h3>
<div id="medicineList"></div>
</div>

<!-- ADD HEALTH TIP -->
<div class="card">
<h3>Add Health Tip</h3>
<textarea id="tipText" placeholder="Enter Health Tip"></textarea>
<button onclick="addTip()">Add Tip</button>
</div>

<!-- TIPS LIST -->
<div class="card">
<h3>Health Tips List</h3>
<div id="tipsList"></div>
</div>

<!-- BACKUP & RESTORE -->
<div class="card">
<h3>Backup & Restore</h3>

<button onclick="downloadBackup()">Download Backup</button>

<input type="file" id="restoreFile" onchange="restoreBackup(this)">
</div>

</div>


<script>
/* ---------------------------------------
   SECURITY: REDIRECT IF NOT LOGGED IN
---------------------------------------- */
if (localStorage.getItem("isLoggedIn") !== "true") {
    window.location.href = "login.html";
}

/* ---------------------------------------
   DEFAULT ADMIN ACCOUNT
---------------------------------------- */
const defaultUser = "admin";
const defaultPass = "Amah123";

if (!localStorage.getItem("adminUser")) {
    localStorage.setItem("adminUser", defaultUser);
}
if (!localStorage.getItem("adminPass")) {
    localStorage.setItem("adminPass", defaultPass);
}

/* LOGOUT */
function logout() {
    localStorage.setItem("isLoggedIn", "false");
    window.location.href = "login.html";
}

/* CHANGE PASSWORD */
function changePassword() {
    let oldp = document.getElementById("oldPass").value;
    let newp = document.getElementById("newPass").value;

    if (oldp !== localStorage.getItem("adminPass")) {
        alert("Incorrect old password!");
        return;
    }
    localStorage.setItem("adminPass", newp);
    alert("Password updated!");
    document.getElementById("oldPass").value = "";
    document.getElementById("newPass").value = "";
}

/* RESET PASSWORD */
function resetDefaultPass() {
    localStorage.setItem("adminUser", defaultUser);
    localStorage.setItem("adminPass", defaultPass);
    alert("Password reset to Amah123");
}

/* ---------------------------------------
   MEDICINES
---------------------------------------- */
function addMedicine() {
    let name = document.getElementById("medName").value;
    let price = document.getElementById("medPrice").value;
    let desc = document.getElementById("medDesc").value;
    let imgFile = document.getElementById("medImg").files[0];

    if (!name || !price || !desc) {
        alert("Please fill all fields");
        return;
    }

    if (!imgFile) {
        alert("Please select a picture!");
        return;
    }

    let reader = new FileReader();
    reader.onload = function(e) {
        let medicines = JSON.parse(localStorage.getItem("medicines") || "[]");

        medicines.push({
            id: Date.now(),
            name,
            price,
            desc,
            img: e.target.result
        });

        localStorage.setItem("medicines", JSON.stringify(medicines));
        alert("Medicine added!");
        loadMedicines();
        updateIndexPage();
    };
    reader.readAsDataURL(imgFile);
}

function loadMedicines() {
    let list = document.getElementById("medicineList");
    list.innerHTML = "";

    let meds = JSON.parse(localStorage.getItem("medicines") || "[]");

    meds.forEach(m => {
        list.innerHTML += `
            <div class="card">
                <img src="${m.img}">
                <h4>${m.name}</h4>
                <p>‚Ç¶${m.price}</p>
                <p>${m.desc}</p>
                <button class="edit-btn" onclick="editMedicine(${m.id})">Edit</button>
                <button class="delete-btn" onclick="deleteMedicine(${m.id})">Delete</button>
            </div>`;
    });
}

function editMedicine(id) {
    let meds = JSON.parse(localStorage.getItem("medicines"));

    let med = meds.find(x => x.id === id);

    let newName = prompt("New name:", med.name);
    let newPrice = prompt("New price:", med.price);
    let newDesc = prompt("New description:", med.desc);

    med.name = newName;
    med.price = newPrice;
    med.desc = newDesc;

    localStorage.setItem("medicines", JSON.stringify(meds));
    loadMedicines();
    updateIndexPage();
}

function deleteMedicine(id) {
    let meds = JSON.parse(localStorage.getItem("medicines"));
    localStorage.setItem("medicines", JSON.stringify(meds.filter(x => x.id !== id)));
    loadMedicines();
    updateIndexPage();
}

/* ---------------------------------------
   HEALTH TIPS
---------------------------------------- */
function addTip() {
    let text = document.getElementById("tipText").value;

    if (!text) {
        alert("Enter a tip!");
        return;
    }

    let tips = JSON.parse(localStorage.getItem("tips") || "[]");

    tips.push({ id: Date.now(), text });

    localStorage.setItem("tips", JSON.stringify(tips));
    document.getElementById("tipText").value = "";
    loadTips();
    updateIndexPage();
}

function loadTips() {
    let list = document.getElementById("tipsList");
    list.innerHTML = "";

    let tips = JSON.parse(localStorage.getItem("tips") || "[]");

    tips.forEach(t => {
        list.innerHTML += `
            <div class="card">
                <p>${t.text}</p>
                <button class="edit-btn" onclick="editTip(${t.id})">Edit</button>
                <button class="delete-btn" onclick="deleteTip(${t.id})">Delete</button>
            </div>`;
    });
}

function editTip(id) {
    let tips = JSON.parse(localStorage.getItem("tips"));
    let tip = tips.find(t => t.id === id);

    let newText = prompt("Edit tip:", tip.text);
    tip.text = newText;

    localStorage.setItem("tips", JSON.stringify(tips));
    loadTips();
    updateIndexPage();
}

function deleteTip(id) {
    let tips = JSON.parse(localStorage.getItem("tips"));
    localStorage.setItem("tips", JSON.stringify(tips.filter(t => t.id !== id)));
    loadTips();
    updateIndexPage();
}

/* ---------------------------------------
   BACKUP / RESTORE
---------------------------------------- */
function downloadBackup() {
    let data = {
        medicines: JSON.parse(localStorage.getItem("medicines") || "[]"),
        tips: JSON.parse(localStorage.getItem("tips") || "[]")
    };

    let blob = new Blob([JSON.stringify(data)], { type: "application/json" });
    let url = URL.createObjectURL(blob);

    let a = document.createElement("a");
    a.href = url;
    a.download = "backup_data.json";
    a.click();
}

function restoreBackup(input) {
    let file = input.files[0];
    let reader = new FileReader();

    reader.onload = function(e) {
        let data = JSON.parse(e.target.result);
        localStorage.setItem("medicines", JSON.stringify(data.medicines));
        localStorage.setItem("tips", JSON.stringify(data.tips));

        alert("Data restored!");
        loadMedicines();
        loadTips();
        updateIndexPage();
    };

    reader.readAsText(file);
}

/* ---------------------------------------
   AUTO SYNC TO index.html
---------------------------------------- */
function updateIndexPage() {
    // Netlify cannot edit files directly.
    // But the live site reads directly from localStorage automatically.
}

/* INITIAL LOAD */
loadMedicines();
loadTips();
</script>

</body>
  </html>
