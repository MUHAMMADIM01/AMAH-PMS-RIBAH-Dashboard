<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Amah Dashboard</title>

<!-- üîí LOGIN PROTECTION -->
<script>
if (localStorage.getItem("isLoggedIn") !== "true") {
   window.location.href = "login.html";
}
</script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #eef2f3;
  margin: 0;
  padding: 0;
}

header {
  background: #00796b;
  color: white;
  padding: 10px;
  text-align: center;
}

.container {
  padding: 20px;
}

/* Cards */
.card {
  background: white;
  padding: 15px;
  margin: 10px 0;
  border-radius: 10px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

input, textarea, button {
  width: 100%;
  padding: 10px;
  margin: 6px 0;
  border-radius: 6px;
  border: 1px solid #aaa;
}

button {
  background: #00796b;
  color: white;
  border: none;
}

button:hover {
  background: #005f52;
}

/* List Items */
.item-card {
  border: 1px solid #ddd;
  padding: 10px;
  margin: 6px 0;
  border-radius: 6px;
  background: #fafafa;
}

.item-card img {
  width: 80px;
  height: 80px;
  object-fit: cover;
  border-radius: 6px;
}

.flex {
  display: flex;
  gap: 10px;
  align-items: center;
}

.actions button {
  width: auto;
  margin-right: 5px;
  padding: 6px 8px;
}
</style>
</head>

<body>

<header>
  <h2>üõ†Ô∏è Amah Medicine Store ‚Äî Admin Dashboard</h2>
  <button onclick="logout()">Logout</button>
</header>

<div class="container">

<!-- ‚≠ê CHANGE PASSWORD -->
<div class="card">
  <h3>üîê Change Username & Password</h3>

  <input id="newUser" placeholder="New Username">
  <input id="newPass" placeholder="New Password">
  <button onclick="changeCredentials()">Update Login Details</button>
</div>

<!-- ‚≠ê ADD MEDICINE -->
<div class="card">
  <h3>üíä Add Medicine</h3>

  <input id="medName" placeholder="Medicine Name">
  <input id="medPrice" placeholder="Price (‚Ç¶)">
  <textarea id="medDesc" placeholder="Description"></textarea>
  <input type="file" id="medPhoto">

  <button onclick="addMedicine()">Add Medicine</button>
</div>

<!-- ‚≠ê MEDICINES LIST -->
<div class="card">
  <h3>üì¶ Medicines List</h3>
  <div id="medList"></div>
</div>

<!-- ‚≠ê ADD TIPS -->
<div class="card">
  <h3>üí° Add Health Tip</h3>

  <textarea id="tipText" placeholder="Write tip here..."></textarea>
  <button onclick="addTip()">Add Tip</button>
</div>

<!-- ‚≠ê TIPS LIST -->
<div class="card">
  <h3>üìò Health Tips List</h3>
  <div id="tipList"></div>
</div>

<!-- ‚≠ê BACKUP & RESTORE -->
<div class="card">
  <h3>üìÇ Backup & Restore</h3>

  <button onclick="downloadBackup()">Download Backup File</button>
  <input type="file" id="restoreFile">
  <button onclick="restoreBackup()">Restore Backup</button>
</div>

</div>

<script>
// ---------------------------
// üîê LOGIN MANAGEMENT
// ---------------------------
function logout() {
  localStorage.setItem("isLoggedIn", "false");
  window.location.href = "login.html";
}

function changeCredentials() {
  const u = document.getElementById("newUser").value;
  const p = document.getElementById("newPass").value;

  if (!u || !p) return alert("Enter username & password");

  localStorage.setItem("adminUser", u);
  localStorage.setItem("adminPass", p);

  alert("‚úî Login details updated!");
}

// ---------------------------
// üíä MEDICINE HANDLING
// ---------------------------
function addMedicine() {
  const name = document.getElementById("medName").value;
  const price = document.getElementById("medPrice").value;
  const desc = document.getElementById("medDesc").value;
  const photoFile = document.getElementById("medPhoto").files[0];

  if (!name || !price) return alert("Name and price required!");

  if (photoFile) {
    const reader = new FileReader();
    reader.onload = () => saveMedicine(name, price, desc, reader.result);
    reader.readAsDataURL(photoFile);
  } else {
    saveMedicine(name, price, desc, "");
  }
}

function saveMedicine(name, price, desc, photo) {
  let meds = JSON.parse(localStorage.getItem("amah_medicines")) || [];
  meds.push({ id: Date.now(), name, price, desc, photo });
  localStorage.setItem("amah_medicines", JSON.stringify(meds));

  renderMedicines();
  alert("‚úî Medicine added!");
}

function renderMedicines() {
  let meds = JSON.parse(localStorage.getItem("amah_medicines")) || [];
  const list = document.getElementById("medList");

  if (meds.length === 0) {
    list.innerHTML = "<p>No medicines yet.</p>";
    return;
  }

  list.innerHTML = meds.map(m => `
    <div class="item-card">
      <div class="flex">
        <img src="${m.photo}">
        <div>
          <b>${m.name}</b><br>
          ‚Ç¶${m.price}<br>
          <small>${m.desc}</small>
        </div>
      </div>
      <div class="actions">
        <button onclick="deleteMedicine(${m.id})">Delete</button>
      </div>
    </div>
  `).join("");
}

function deleteMedicine(id) {
  let meds = JSON.parse(localStorage.getItem("amah_medicines")) || [];
  meds = meds.filter(x => x.id !== id);
  localStorage.setItem("amah_medicines", JSON.stringify(meds));
  renderMedicines();
}

// ---------------------------
// üí° HEALTH TIPS
// ---------------------------
function addTip() {
  const t = document.getElementById("tipText").value;
  if (!t) return alert("Write a tip!");

  let tips = JSON.parse(localStorage.getItem("amah_tips")) || [];
  tips.push(t);
  localStorage.setItem("amah_tips", JSON.stringify(tips));

  renderTips();
}

function renderTips() {
  let tips = JSON.parse(localStorage.getItem("amah_tips")) || [];
  const list = document.getElementById("tipList");

  if (tips.length === 0) {
    list.innerHTML = "<p>No tips yet.</p>";
    return;
  }

  list.innerHTML = tips.map((t,i) => `
    <div class="item-card">
      ${t}
      <div class="actions">
        <button onclick="deleteTip(${i})">Delete</button>
      </div>
    </div>
  `).join("");
}

function deleteTip(i) {
  let tips = JSON.parse(localStorage.getItem("amah_tips")) || [];
  tips.splice(i,1);
  localStorage.setItem("amah_tips", JSON.stringify(tips));
  renderTips();
}

// ---------------------------
// üìÇ BACKUP / RESTORE
// ---------------------------
function downloadBackup() {
  const data = {
    medicines: JSON.parse(localStorage.getItem("amah_medicines")) || [],
    tips: JSON.parse(localStorage.getItem("amah_tips")) || []
  };

  const blob = new Blob([JSON.stringify(data)], {type: "application/json"});
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "backup_data.json";
  a.click();
}

function restoreBackup() {
  const file = document.getElementById("restoreFile").files[0];
  if (!file) return alert("Upload backup file!");

  const reader = new FileReader();
  reader.onload = () => {
    const data = JSON.parse(reader.result);

    localStorage.setItem("amah_medicines", JSON.stringify(data.medicines));
    localStorage.setItem("amah_tips", JSON.stringify(data.tips));

    renderMedicines();
    renderTips();

    alert("‚úî Data restored!");
  };
  reader.readAsText(file);
}

document.addEventListener("DOMContentLoaded", () => {
  renderMedicines();
  renderTips();
});
</script>

</body>
</html>
